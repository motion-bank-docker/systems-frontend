(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"1N2q":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(e._s(e.videoTitle))])},a=[],r=(n("ls82"),n("yXPU")),o=n.n(r),s=(n("SRfc"),n("pIFo"),n("VRzm"),n("33yf")),l=n.n(s),u=n("CxY0"),c=n.n(u),d=n("ktc5"),p=n.n(d),f=function(e){var t=this,n=this;return Promise.resolve().then(function(){if(0===e.indexOf("http"))return".mp4"===l.a.extname(c.a.parse(e).path)&&(e=e.replace(/\.mp4/i,".html")),t.$axios.get("".concat(n.$globalConfig.app.hosts.api,"/proxy?url=").concat(encodeURIComponent(e))).then(function(e){var t=e.text.match(/<title[^>]*>([^<]+)<\/title>/)[1];return p.a.decode(t)}).catch(function(t){return console.warn("Error getting title for ".concat(e,": ").concat(t.message)),e})})},m={props:["source"],asyncComputed:{videoTitle:function(){var e=o()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f(this.source);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},v=m,h=n("KHd+");n.d(t,!1,function(){return f});var y=Object(h["a"])(v,i,a,!1,null,null,null);t["a"]=y.exports},"2Gtw":function(e,t,n){"use strict";n("f3/d");var i=n("cDf5"),a=n.n(i),r=n("lwsE"),o=n.n(r),s=n("W8MJ"),l=n.n(s),u=n("ExVU"),c=n("9lTW"),d=n.n(c);u["Settings"].defaultLocale=u["DateTime"].local().resolvedLocaleOpts().locale;var p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o()(this,e),this._dateTime=t?u["DateTime"].local().toUTC():u["DateTime"].local()}return l()(e,[{key:"setToUTC",value:function(){this._dateTime=this._dateTime.toUTC()}},{key:"toString",value:function(){return this.isoString}},{key:"toFormat",value:function(e){return d.a.equal(a()(e),"string"),this._dateTime.toFormat(e)}},{key:"add",value:function(e){d()("number"===typeof e||"Duration"===e.constructor.name),this._dateTime=this._dateTime.plus(e)}},{key:"subtract",value:function(e){d()("number"===typeof e||"Duration"===e.constructor.name),this._dateTime=this._dateTime.minus(e)}},{key:"isoString",set:function(e){d.a.equal(a()(e),"string"),this._dateTime=u["DateTime"].fromISO(e)},get:function(){return this._dateTime.toISO()}},{key:"millis",set:function(e){d.a.equal(a()(e),"number"),this._dateTime=u["DateTime"].fromMillis(e)},get:function(){return this._dateTime.valueOf()}},{key:"dateTime",set:function(e){d()(e instanceof u["DateTime"]),this._dateTime=u["DateTime"].fromISO(e.toISO())},get:function(){return this._dateTime}}],[{key:"fromISOString",value:function(t){var n=new e;return n.isoString=t,n}},{key:"fromMilliseconds",value:function(t){var n=new e;return n.millis=t,n}},{key:"fromDateTime",value:function(t){var n=new e;return n.dateTime=t,n}},{key:"timeBetween",value:function(e,t){return d.a.equal(e.constructor.name,"TimelineSelector"),d.a.equal(t.constructor.name,"TimelineSelector"),u["Interval"].fromDateTimes(e.dateTime,t.dateTime).toDuration()}}]),e}();t["a"]=p},"3+gH":function(e,t,n){"use strict";var i=n("gdjL"),a=n.n(i);a.a},"4yR+":function(e,t,n){"use strict";var i=n("d1oh"),a=n.n(i);a.a},84:function(e,t){},AUIa:function(e,t,n){},"Cu/4":function(e,t,n){},H9d8:function(e,t,n){"use strict";var i=n("VVPy"),a=n.n(i);a.a},Ir0S:function(e,t,n){"use strict";var i=n("WUGF"),a=n.n(i);a.a},JUnI:function(e,t,n){"use strict";var i={};n.d(i,"TimelineSelector",function(){return a["a"]});var a=n("2Gtw"),r=n("lwsE"),o=n.n(r),s=n("W8MJ"),l=n.n(s),u=function(){function e(){o()(this,e)}return l()(e,null,[{key:"sortOnTarget",value:function(e,t){var n=e.target&&e.target.selector?a["a"].fromISOString(e.target.selector.value):null,i=t.target&&t.target.selector?a["a"].fromISOString(t.target.selector.value):null;return n&&i&&n.dateTime>i.dateTime?1:n&&i&&n.dateTime<i.dateTime?-1:0}}]),e}(),c=u;t["a"]={selectors:i,Sorting:c}},KtXb:function(e,t,n){},Nxwe:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"cell-item-inner",class:{"display-preview":e.preview,"display-full":e.display}},[e.cellTypeName?[n(e.cellTypeName,{tag:"component",class:"cell-content cell-type-"+e.cell.type.toLowerCase(),attrs:{cell:e.cell,display:e.display,preview:e.preview,messenger:e.messenger}})]:[n("div",[e._v("Empty cell")])],e._t("default")],2)},a=[],r=(n("pIFo"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")}),o=[],s={props:["cell"]},l=s,u=(n("pbRf"),n("KHd+")),c=Object(u["a"])(l,r,o,!1,null,"f61c91a8",null),d=c.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("div",[e._v(e._s(e.textContent))])]:[n("strong",[e._v("Text Cell")])]],2)},f=[],m={props:["cell","display","preview"],data:function(){return{}},computed:{textContent:function(){return this.cell["content"]}}},v=m,h=(n("Ir0S"),Object(u["a"])(v,p,f,!1,null,"3617096c",null)),y=h.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("h1",[e._v(e._s(e.titleContent))])]:[n("strong",[e._v("Title Cell")])]],2)},T=[],w={props:["cell","display","preview"],data:function(){return{}},computed:{titleContent:function(){return this.cell["content"]}}},_=w,x=(n("H9d8"),Object(u["a"])(_,g,T,!1,null,"66c11dc2",null)),C=x.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("img",{attrs:{src:e.imgSrc}})]:[n("div",{staticClass:"cell-background",style:e.cellBackgroundStyle}),n("strong",[e._v("Image Cell")])]],2)},S=[],O={props:["cell","display","preview"],data:function(){return{cellBackgroundStyle:{}}},computed:{imgSrc:function(){return this.cell["content"]}},mounted:function(){this.preview&&(this.cellBackgroundStyle={"background-image":"url(".concat(this.imgSrc,")")})}},E=O,k=(n("uQKt"),Object(u["a"])(E,b,S,!1,null,"4fea3a60",null)),P=k.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("iframe",{attrs:{src:e.iframeSrc},on:{load:e.handleIframeLoaded}})]:[n("strong",[e._v(e._s(e.iframeSrc))])]],2)},D=[],$={props:["cell","display","preview"],data:function(){return{}},computed:{iframeSrc:function(){return this.cell.content}},methods:{handleIframeLoaded:function(e){console.log(e)}}},R=$,A=(n("4yR+"),Object(u["a"])(R,I,D,!1,null,"59a3a51a",null)),U=A.exports,j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("router-link",{attrs:{to:e.internalLink}},[n("div",[e._v("--\x3e "+e._s(e.internalLink.path))])])]:[n("strong",[e._v("Link Cell")])]],2)},q=[],L={props:["cell","display","preview"],data:function(){return{}},computed:{internalLink:function(){return{path:this.cell.content}}}},V=L,H=(n("qJrX"),Object(u["a"])(V,j,q,!1,null,"410c6fa2",null)),M=H.exports,F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("video-player",{attrs:{src:e.video.body||e.fauxVideo},on:{ready:e.handlePlayerReady,play:e.handlePlayerPlaying,time:e.handlePlayerTimeChange}})]:[n("strong",[e._v("Video Cell")])]],2)},N=[],G=n("hP65"),J={components:{VideoPlayer:G["a"]},props:["cell","display","preview","messenger"],data:function(){return{video:{},videoTime:-1,player:{}}},computed:{fauxVideo:function(){var e={type:"Video",purpose:"linking",source:this.cell["content"]};return e},videoSrcType:function(){return this.videoSrc.indexOf("youtube.com")>=0?"video/youtube":"html5"}},mounted:function(){var e=this;this.cell.sourceUuid&&this.$store.dispatch("annotations/find",{query:{uuid:this.cell.sourceUuid}}).then(function(t){var n=t.shift();n&&(e.video=n,e.videoTime=Date.parse(n.target.selector.value),e.contextTime=e.videoTime)}),this.display&&this.messenger&&this.messenger.$on("annotation-trigger",function(t,n){if(e.video.target&&t.target.id===e.video.target.id){var i=(n-e.videoTime)/1e3;"number"===typeof i&&i>=0&&e.player&&e.player.currentTime(i)}})},methods:{getSignature:function(){return this.video?{origin:this.video,type:"Video"}:{origin:this.cell,type:"2DCell"}},handlePlayerReady:function(e){this.messenger.$emit("video-loaded",this.getSignature()),this.player=e},handlePlayerPlaying:function(){this.messenger.$emit("video-started-playing",this.getSignature())},handlePlayerTimeChange:function(e){var t=Date.now();this.videoTime&&(t=this.videoTime+1e3*e),this.messenger.$emit("video-time-changed",e,t,this.getSignature())}}},B=J,K=(n("wWER"),Object(u["a"])(B,F,N,!1,null,"57a943ea",null)),W=K.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("div",{domProps:{innerHTML:e._s(e.htmlContent)}})]:[n("strong",[e._v("'HTML Cell'")])]],2)},Q=[],Y={props:["cell","display","preview"],data:function(){return{}},computed:{htmlContent:function(){return this.cell.additional_fields["html-content"]}}},z=Y,Z=(n("bEHZ"),Object(u["a"])(z,X,Q,!1,null,"b644f884",null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("span",[e._v("A Timeline ... not sure how to display it here")])]:[n("strong",[e._v("Timeline Cell")])]],2)},ne=[],ie={props:["cell","display","preview"],data:function(){return{}}},ae=ie,re=(n("joBj"),Object(u["a"])(ae,te,ne,!1,null,"8442fea8",null)),oe=re.exports,se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"annotation-list",class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("q-list-header",[n("q-item",[n("video-title",{attrs:{source:e.video.body.source}})],1)],1),e._l(e.annotations,function(t,i){return[n("q-item-separator"),e.$store.state.auth.payload.userId&&e.showAnnotationInput(i)?[n("q-item",{staticClass:"annotation-input-container"},[n("q-input",{staticClass:"annotation-input",staticStyle:{width:"100%"},attrs:{type:"textarea","max-height":"200","min-rows":"3","stack-label":"Leave Comment"},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleInputChanged(t):null}},model:{value:e.newAnnotationText,callback:function(t){e.newAnnotationText=t},expression:"newAnnotationText"}})],1),n("q-item-separator")]:e._e(),n("q-item",{staticClass:"annotation"},[n("a",{class:{active:e.contextTime&&e.inContextTime(t,i)},on:{click:function(n){return n.preventDefault(),function(n){e.handleAnnotationClick(n,t,i)}(n)}}},[n("span",{staticClass:"date"},[e._v(e._s(e.formatDate(t,i).split(":").slice(1).join(":")))]),n("Username",{staticClass:"author",attrs:{uuid:t.author}}),n("span",{staticClass:"content"},[e._v(e._s(t.body.value))])],1)])]}),n("q-item-separator")]:[n("strong",[e._v("Annotation List")])]],2)},le=[],ue=(n("Vd3H"),n("dRSK"),n("ExVU")),ce=n("wbdi"),de=n("Tjd0"),pe=n("1N2q"),fe=n("JUnI"),me=fe["a"].selectors.TimelineSelector,ve={components:{Username:de["a"],VideoTitle:pe["a"]},props:["cell","display","preview","messenger"],data:function(){return{videoUuid:"",video:{},videoTime:{},contextTime:{},annotations:[],map:{},annotationTimes:[],inputIndex:0,newAnnotationText:""}},mounted:function(){var e=this;this.videoUuid=this.cell.content,this.messenger&&this.messenger.$on("video-time-changed",function(t,n,i){if("Video"===i.type&&e.video.target.id===i.origin.target.id&&e.videoTime<=n){e.contextTime=n;var a=e.annotationTimes.find(function(t){return t>=e.contextTime});e.inputIndex=a?e.annotationTimes.indexOf(a):0}})},watch:{videoUuid:function(){this.fetchAnnotations()}},methods:{handleInputChanged:function(){var e=this;if(this.newAnnotationText){var t={author:this.$store.state.auth.payload.userId,type:"Annotation",body:{type:"TextualBody",purpose:"commenting",value:this.newAnnotationText},target:{id:this.map.uuid,type:this.map.type,selector:{type:"Fragment",value:me.fromMilliseconds(e.contextTime).isoString}}};this.$store.dispatch("annotations/create",t).then(function(){e.fetchAnnotations()})}this.newAnnotationText=""},handleAnnotationClick:function(e,t,n){this.messenger.$emit("annotation-trigger",t,this.annotationTimes[n])},inContextTime:function(e,t){var n=this.annotationTimes[t]-this.contextTime;return Math.abs(n)<2e3},contextTimeDiff:function(e,t){return this.annotationTimes[t]-this.contextTime},formatDate:function(e){return ue["DateTime"].fromISO(e.target.selector.value).minus(this.videoTime).toFormat(ce["a"].TIMECODE_FORMAT)},showAnnotationInput:function(e){return e===this.inputIndex},fetchAnnotations:function(){var e=this;this.$store.dispatch("annotations/find",{query:{uuid:this.videoUuid}}).then(function(t){var n=t.shift();n&&(e.video=n,e.videoTime=Date.parse(e.video.target.selector.value),e.contextTime=e.videoTime,e.$store.dispatch("maps/find",{query:{uuid:n.target.id}}).then(function(t){var n=t.shift();n&&(e.map=n)}),e.$store.dispatch("annotations/find",{query:{"target.id":n.target.id,"body.purpose":"commenting"}}).then(function(t){t=t.filter(function(t){return Date.parse(t.target.selector.value)>=e.videoTime}),t=t.sort(function(e,t){var n=Date.parse(e.target.selector.value)-Date.parse(t.target.selector.value);return 0===n&&(n=Date.parse(t.created)-Date.parse(e.created)),n}),e.annotations=t,e.annotationTimes=[],t.forEach(function(t){e.annotationTimes.push(Date.parse(t.target.selector.value))})}))})}}},he=ve,ye=(n("3+gH"),Object(u["a"])(he,se,le,!1,null,"fec42246",null)),ge=ye.exports,Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"display-preview":e.preview,"display-full":e.display}},[e.display?[n("span",[e._v("A Timeline ... not sure how to display it here")])]:[n("strong",[e._v("2D Grid Cell")])]],2)},we=[],_e={props:["cell","display","preview"],data:function(){return{}}},xe=_e,Ce=(n("yLQR"),Object(u["a"])(xe,Te,we,!1,null,"2265e5ee",null)),be=Ce.exports,Se={CellUIFeedback:d,CellTitle:C,CellText:y,CellHtml:ee,CellImage:P,CellIFrame:U,CellInternalLink:M,CellVideo:W,CellAnnotationList:ge,CellTimeline:oe,Cell2DGrid:be},Oe={props:["cell","display","preview","messenger","annotation"],data:function(){return{selected:!1}},computed:{cellTypeName:function(){return this.cell.type?this.cellTypeToClassName(this.cell.type):""}},mounted:function(){if(this.cellTypeName&&!1===Se.hasOwnProperty(this.cellTypeName))throw new Error("This cell type is missing: "+this.cell.type)},methods:{cellTypeToClassName:function(e){return"Cell"+e.slice(0,1).toUpperCase()+e.slice(1).replace(/[^a-z0-9]/gi,"")},handleClick:function(){this.selected=!this.selected},handleDragStart:function(e){e.dataTransfer.setData("text/plain",JSON.stringify(this.cell))}},components:Se},Ee=Oe,ke=(n("ti9Z"),Object(u["a"])(Ee,i,a,!1,null,"206329f2",null));t["a"]=ke.exports},Tjd0:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(e._s(e.username))])},a=[],r=(n("f3/d"),n("ls82"),n("yXPU")),o=n.n(r),s={props:["uuid"],asyncComputed:{username:function(){var e=o()(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.uuid){e.next=2;break}return e.abrupt("return","---");case 2:return e.next=4,this.$store.dispatch("users/get",this.uuid);case 4:return t=e.sent,e.abrupt("return",t.name);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},l=s,u=n("KHd+"),c=Object(u["a"])(l,i,a,!1,null,null,null);t["a"]=c.exports},UVH4:function(e,t,n){},VVPy:function(e,t,n){},WUGF:function(e,t,n){},bEHZ:function(e,t,n){"use strict";var i=n("zRFR"),a=n.n(i);a.a},"bf/G":function(e,t,n){},d1oh:function(e,t,n){},gdjL:function(e,t,n){},hP65:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("video-player",{ref:"videoPlayer",staticClass:"video-player-box vjs-big-play-centered",attrs:{options:e.playerOptions,playsinline:!0,customEventName:"customstatechangedeventname"},on:{play:function(t){e.onPlayerEvent("play",t)},pause:function(t){e.onPlayerEvent("pause",t)},ended:function(t){e.onPlayerEvent("ended",t)},waiting:function(t){e.onPlayerEvent("waiting",t)},playing:function(t){e.onPlayerEvent("playing",t)},loadeddata:function(t){e.onPlayerEvent("data",t)},timeupdate:function(t){e.onPlayerEvent("time",t.currentTime())},canplay:function(t){e.onPlayerEvent("canplay",t)},canplaythrough:function(t){e.onPlayerEvent("canplaythrough",t)},statechanged:function(t){e.playerStateChange(t)},ready:e.onPlayerReady}})},a=[],r=n("1tPa");n("/aIJ"),n("RR9+"),n("49ep"),n("TG1J"),n("9aQL");var o={components:{videoPlayer:r["videoPlayer"]},data:function(){return{type:void 0,playerOptions:{fluid:!0,width:640,techOrder:["html5"],language:"en",playbackRates:[.25,.5,1,1.5,2],sources:[],poster:void 0,controlBar:{remainingTime:!0},plugins:{framebyframe:{fps:23.98,steps:[{text:"-1s",step:-24},{text:"-1f",step:-1},{text:"+1f",step:1},{text:"+1s",step:24}]}}}}},props:["src"],mounted:function(){this.src&&(this.type=this.guessType(this.src),"video/youtube"===this.type?this.playerOptions.techOrder=["youtube"]:"video/vimeo"===this.type&&(this.playerOptions.techOrder=["vimeo"]),this.setSources([{type:this.type,src:this.src.source}]))},watch:{src:function(e){this.type=this.guessType(e),e&&("video/youtube"===this.type?this.playerOptions.techOrder=["youtube"]:"video/vimeo"===this.type&&(this.playerOptions.techOrder=["vimeo"]),this.setSources([{type:this.type,src:e.source}]))}},computed:{player:function(){return this.$refs.videoPlayer.player}},methods:{guessType:function(e){return e.source.indexOf("youtube.com")>-1||e.source.indexOf("youtu.be")>-1?"video/youtube":e.source.indexOf("vimeo.com")>-1?"video/vimeo":null},onPlayerReady:function(e){this.$emit("ready",e),"video/youtube"===this.type||this.type},onPlayerEvent:function(e,t){this.$emit(e,t)},onPlayerStateChange:function(e){this.$emit("state-change",e)},setSources:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Array.isArray(e)||(e=[e]),this.playerOptions.sources=e,this.playerOptions.poster=t}}},s=o,l=n("KHd+"),u=Object(l["a"])(s,i,a,!1,null,null,null);t["a"]=u.exports},joBj:function(e,t,n){"use strict";var i=n("KtXb"),a=n.n(i);a.a},pbRf:function(e,t,n){"use strict";var i=n("UVH4"),a=n.n(i);a.a},qJrX:function(e,t,n){"use strict";var i=n("Cu/4"),a=n.n(i);a.a},qVY3:function(e,t,n){},ti9Z:function(e,t,n){"use strict";var i=n("bf/G"),a=n.n(i);a.a},uQKt:function(e,t,n){"use strict";var i=n("qVY3"),a=n.n(i);a.a},wWER:function(e,t,n){"use strict";var i=n("AUIa"),a=n.n(i);a.a},wbdi:function(e,t,n){"use strict";var i="Timeline",a="2DGrid",r="HH:mm:ss:SSS";t["a"]={MAP_TYPE_TIMELINE:i,MAP_TYPE_2D_GRID:a,TIMECODE_FORMAT:r}},"xBP+":function(e,t,n){},yLQR:function(e,t,n){"use strict";var i=n("xBP+"),a=n.n(i);a.a},zRFR:function(e,t,n){}}]);