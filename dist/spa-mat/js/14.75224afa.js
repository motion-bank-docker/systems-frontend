(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"0GAc":function(e,t,i){"use strict";var n=i("0R1q"),a=i.n(n);a.a},"0R1q":function(e,t,i){},"6y65":function(e,t,i){"use strict";var n=i("aEYj"),a=i.n(n);a.a},"8yf9":function(e,t,i){"use strict";var n=i("hGge"),a=i.n(n);a.a},"D/9Z":function(e,t,i){},Egr1:function(e,t,i){"use strict";var n=i("gdU5"),a=i.n(n);a.a},FSkN:function(e,t,i){"use strict";var n=i("uQw1"),a=i.n(n);a.a},GLJN:function(e,t,i){"use strict";var n=i("cRqT"),a=i.n(n);a.a},MlLm:function(e,t,i){},ZdiX:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"grid-editor-container",class:{"sources-open":e.$store.state.mosysGridEditorStore.showSources}},[i("div",{staticClass:"backbutton"},[i("q-btn",{attrs:{slot:"backButton",icon:"keyboard_backspace",round:"",small:"",color:"black"},on:{click:function(t){e.$router.push("/mosys/grids")}},slot:"backButton"})],1),e.$store.state.mosysGridEditorStore.showSources?i("div",{staticClass:"grid-editor-shadow-right"}):e._e(),i("grid-editor",{staticClass:"grid-editor",attrs:{gridUuid:e.$route.params.id}}),e.$store.state.mosysGridEditorStore.showSources?i("grid-editor-sources",{staticClass:"grid-editor-sources"}):e._e()],1)},a=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cell-grid-container"},[i("div",{staticClass:"cell-grid",style:e.gridStyle,on:{dragenter:e.handleGridDragOver,dragover:e.handleGridDragOver,dragleave:e.handleGridDragEnd,drop:e.handleGridDrop,contextmenu:e.handleGridContextMenu}},[i("q-context-menu",{ref:"gridmenu"},[i("q-list",{staticStyle:{"min-width":"150px","max-height":"300px"},attrs:{link:"",separator:"","no-border":""}},e._l(e.gridContextMenuActions,function(t){return i("q-item",{key:t.label,on:{click:function(i){t.handler(i),e.$refs.gridmenu.close()}}},[i("q-item-main",{attrs:{label:t.label}})],1)}))],1),e._l(e.cells,function(t,n){return[e.cellUIStates[t.uuid]&&!e.cellUIStates[t.uuid].beingDragged?i("div",{staticClass:"cell-item",class:{selected:!!e.cellUIStates[t.uuid]&&e.cellUIStates[t.uuid].selected},style:e.getCellStyle(t),attrs:{draggable:"true",title:t.title},on:{dragstart:function(i){e.handleCellDragStart(i,t)},dragend:function(i){e.handleCellDragEnd(i,t)},contextmenu:e.handleCellContextMenu,click:function(i){return i.preventDefault(),function(i){e.handleCellClick(i,t)}(i)}}},[i("cell",{attrs:{cell:t,preview:""}}),i("div",{staticClass:"cell-item-resize-handle",attrs:{draggable:"true"},on:{dragstart:function(i){e.handleCellResizerDragStart(i,t)},dragend:function(i){e.handleCellResizerDragEnd(i,t)},dragexit:function(i){e.handleCellResizerDragEnd(i,t)}}},[i("q-icon",{attrs:{name:"network cell"}})],1),i("q-context-menu",[i("q-list",{staticStyle:{"min-width":"150px","max-height":"300px"},attrs:{link:"",separator:"","no-border":""}},e._l(e.cellContextMenuActions,function(e){return i("q-item",{key:e.label,on:{click:function(i){e.handler(i,t)}}},[i("q-item-main",{attrs:{label:e.label}})],1)}))],1)],1):e._e()]}),e._l(e.tmpCells,function(t,n){return[i("div",{staticClass:"cell-item cell-item-tmp",style:e.getCellStyle(t)},[i("cell",{attrs:{cell:t}})],1)]}),e.$store.state.mosysGridEditorStore.showSources?e._e():i("q-fixed-position",{attrs:{corner:"top-right",offset:[18,18]}},[i("q-btn",{staticStyle:{"margin-right":"0.5em"},attrs:{round:"",color:"primary",small:""},on:{click:e.handleGridButtonClickEdit}},[i("q-icon",{attrs:{name:"add"}})],1),i("q-btn",{attrs:{round:"",color:"primary",small:""},on:{click:function(t){e.$router.push("/mosys/grids/"+e.$route.params.id)}}},[i("q-icon",{attrs:{name:"remove red eye"}})],1)],1)],2)])},s=[],o=(i("VRzm"),i("Z2Ku"),i("L9s1"),i("dRSK"),i("GBbM")),l=i("Nxwe"),c=new Image;c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";var d={components:{Cell:l["a"]},props:["gridUuid"],data:function(){return{cellContextMenuActions:{delete:{label:"Delete",handler:this.handleCellContextMenuDelete},insert_column_left:{label:"Insert Column Left",handler:this.handleGridContextMenuInsertColumnLeft},insert_row_above:{label:"Insert Row Above",handler:this.handleGridContextMenuInsertRowAbove}},gridContextMenuActions:{insert_column_left:{label:"Insert Column Left",handler:this.handleGridContextMenuInsertColumnLeft},insert_row_above:{label:"Insert Row Above",handler:this.handleGridContextMenuInsertRowAbove}},gridMetadata:{},cells:[],tmpCells:[],cellUIStates:{},gridDimensions:{gridWidth:0,gridHeight:0,cellWidth:0,cellHeight:0},gridStyle:{},contextMenuClickPosition:{}}},mounted:function(){var e=this,t=this;window.addEventListener("resize",this.updateGridDimensions),this.fetchMetadataAnnotations().then(function(){e.updateGridDimensions(),t.fetchCellAnnotations()})},beforeDestroy:function(){window.removeEventListener("resize",this.updateGridDimensions)},watch:{cells:function(){this.updateCellUIStates()},gridUuid:function(){console.log("Grid UUID changed, fetch metadata again??")},gridMetadata:function(){this.updateGridDimensions()}},methods:{handleCellResizerDragStart:function(e,t){e.dataTransfer.setDragImage(c,0,0),this.cellUIStates[t.uuid].beingResized=!0;var i=this.getTmpCell(t);this.tmpCells.push(i)},handleCellResizerDragEnd:function(e,t){var i=this.getGridPositionForEvent(e);t.width=Math.max(1,1+i.x-t.x),t.height=Math.max(1,1+i.y-t.y),this.cellUIStates[t.uuid].beingResized=!1,this.tmpCells=[],this.updateCellStore(t)},handleCellClick:function(e,t){var i=this;this.cellUIStates[t.uuid].selected=!this.cellUIStates[t.uuid].selected;var n=Object.keys(this.cellUIStates).filter(function(e){return i.cellUIStates[e].selected}).map(function(e){return i.cells.find(function(t){return t.uuid===e})});this.$store.commit("mosysGridEditorStore/setSelectedCells",n)},handleCellDragStart:function(e,t){if(this.cellUIStates[t.uuid].beingResized);else{e.dataTransfer.setData("text/plain",JSON.stringify(t)),e.dataTransfer.setDragImage(c,0,0),this.cellUIStates[t.uuid].beingDragged=!0;var i=this.$el.getBoundingClientRect(),n=e.srcElement.getBoundingClientRect(),a={x:e.clientX-i.x-(n.x-i.x),y:e.clientY-i.y-(n.y-i.y)};this.cellUIStates[t.uuid].draggingOffset=a,this.cellUIStates[t.uuid].beginDragged=!0}var r=this.getTmpCell(t);this.tmpCells.push(r)},handleCellDragEnd:function(e,t){this.cellUIStates[t.uuid].beingDragged=!1},handleCellContextMenuClick:function(){},handleCellContextMenuEdit:function(){},handleCellContextMenuDelete:function(e,t,i){var n=this;n.cells=n.cells.filter(function(e){return e!==t}),this.$store.dispatch("annotations/remove",t.uuid).then(function(){n.fetchCellAnnotations()}),i&&this.$refs[i].close()},handleCellContextMenu:function(e){this.contextMenuClickPosition=this.getGridPositionForEvent(e)},handleGridDragOver:function(e){var t,i,n=this,a=Object.keys(this.cellUIStates).filter(function(e){return n.cellUIStates[e].beginDragged||n.cellUIStates[e].beingResized}).map(function(e){return n.cellUIStates[e].cell}).shift();a?(t=this.cellUIStates[a.uuid].draggingOffset,i=this.getGridPositionForEvent(e,t)):(a={uuid:null,x:1,y:1,width:1,height:1},i=this.getGridPositionForEvent(e));var r=this.tmpCells[0];r||0!==this.tmpCells.length||(r=this.getTmpCell(a),this.tmpCells.push(r)),e.dataTransfer.types.includes("text/plain")?(r.x=i.x,r.y=i.y,e.preventDefault()):(r.width=Math.max(1,1+i.x-r.x),r.height=Math.max(1,1+i.y-r.y))},handleGridDragEnd:function(){this.tmpCells=[]},handleGridDrop:function(e){var t=e.dataTransfer.getData("text/plain");if(t){t=JSON.parse(t);var i,n,a=this.cells.find(function(e){return e.uuid===t.uuid});a?(i=this.cellUIStates[a.uuid].draggingOffset,n=this.getGridPositionForEvent(e,i)):(a=t,n=this.getGridPositionForEvent(e)),a.x=n.x,a.y=n.y,this.tmpCells=[],this.updateCellStore(a),e.preventDefault()}},handleGridContextMenu:function(e){this.contextMenuClickPosition=this.getGridPositionForEvent(e)},handleGridContextMenuAddCell:function(){var e=this,t=this.contextMenuClickPosition,i={x:t.x,y:t.y,width:1,height:1,type:"text",content:"A new cell is born"},n=this.getGridCellAnnotation(i);Promise.resolve().then(function(){return e.$store.dispatch("annotations/create",n)}).then(function(){e.fetchCellAnnotations()})},handleGridContextMenuInsertColumnLeft:function(){var e=this,t=this,i=this.contextMenuClickPosition;this.cells.map(function(n){if(n.x>=i.x){n.x+=1;var a=e.getGridCellAnnotation(n);Promise.resolve().then(function(){return t.$store.dispatch("annotations/patch",[n.uuid,a])}).then(function(){t.fetchCellAnnotations()})}return n}),this.gridMetadata=o["ObjectUtil"].merge({},this.gridMetadata,{columns:this.gridMetadata.columns+1}),this.updateGridMetadataStore()},handleGridContextMenuInsertRowAbove:function(){var e=this,t=this,i=this.contextMenuClickPosition;this.cells.map(function(n){if(n.y>=i.y){n.y+=1;var a=e.getGridCellAnnotation(n);Promise.resolve().then(function(){return t.$store.dispatch("annotations/patch",[n.uuid,a])}).then(function(){t.fetchCellAnnotations()})}return n}),this.gridMetadata=o["ObjectUtil"].merge({},this.gridMetadata,{rows:this.gridMetadata.rows+1}),this.updateGridMetadataStore()},handleGridButtonClickEdit:function(){this.$store.commit("mosysGridEditorStore/toggleSources")},handleGridKeyReleased:function(){},updateCellUIStates:function(){var e={};this.cells.map(function(t){e[t.uuid]={selected:!1,beingResized:!1,cell:t}}),this.cellUIStates=e},getTmpCell:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UIFeedback";return{srcUuid:e.uuid,type:t,x:e.x,y:e.y,width:e.width,height:e.height}},getGridPositionForEvent:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};t={x:0,y:0};var i=this.$el.getBoundingClientRect(),n=e.clientX+this.$el.scrollLeft-i.x-t.x,a=e.clientY+this.$el.scrollTop-i.y-t.y;return n=Math.ceil(n/this.gridDimensions.full.cell.width),a=Math.ceil(a/this.gridDimensions.full.cell.height),{x:n,y:a}},updateGridDimensions:function(){var e=this.$el.offsetWidth,t=this.$el.offsetHeight,i=this.gridMetadata.ratio,n=t,a=n/this.gridMetadata.rows,r=e/Math.round(e/(a*i)),s=r*this.gridMetadata.columns,o=e/r,l=e/this.gridMetadata.columns,c=l/i;this.gridDimensions={full:{width:s,height:n,cell:{width:r,height:a},cells_per_width:o},mini:{width:e,height:c*this.gridMetadata.rows,cell:{width:l,height:c}}},this.gridStyle={width:this.gridDimensions.full.width+"px",height:"100%","grid-auto-columns":this.gridDimensions.full.cell.width+"px","grid-auto-rows":this.gridDimensions.full.cell.height+"px","background-image":this.getGridBackgroundSVG(this.gridDimensions.full.cell)}},getGridBackgroundSVG:function(e){return"url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'><defs><pattern id='smallGrid' width='".concat(e.width,"' height='").concat(e.height,"' patternUnits='userSpaceOnUse'><path d='M ").concat(e.width," 0 L 0 0 0 ").concat(e.height,"' fill='none' stroke='gray' stroke-width='0.5'/></pattern></defs><rect width='100%' height='100%' fill='url(#smallGrid)' /></svg>\")")},fetchCellAnnotations:function(){var e=this,t={query:{"body.type":"2DCell","target.id":this.gridUuid}};this.$store.dispatch("annotations/find",t).then(function(t){e.cells=t.map(function(e){var t=JSON.parse(e.body.value);return t?(t.uuid=e.uuid,t):null}).filter(function(e){return e}),e.updateCellUIStates()})},fetchMetadataAnnotations:function(){var e=this,t=this,i={query:{"body.type":"2DGridMetadata","target.id":this.gridUuid}};return new Promise(function(n,a){e.$store.dispatch("annotations/find",i).then(function(e){var i=e.shift();if(i){var a=JSON.parse(i.body.value);a.uuid=i.uuid,a&&(t.gridMetadata=a,n())}else t.gridMetadata={columns:10,rows:6,ratio:16/9},t.updateGridMetadataStore()}).catch(a)})},getGridCellAnnotation:function(e){return{body:{type:"2DCell",purpose:"linking",value:JSON.stringify(e)},author:this.$store.state.auth.payload.userId,target:{id:this.gridUuid,type:"Map",selector:{type:"2DLocation",value:"x=".concat(e.x,"&y=").concat(e.y,"&width=").concat(e.width,"&height=").concat(e.height)}}}},getGridMetadataAnnotation:function(e,t){return{body:{type:"2DGridMetadata",purpose:"linking",value:JSON.stringify(t)},author:this.$store.state.auth.payload.userId,target:{id:e,type:"Map"}}},updateCellStore:function(e){var t=this,i=this.getGridCellAnnotation(e);Promise.resolve().then(function(){return e.uuid?t.$store.dispatch("annotations/patch",[e.uuid,i]):t.$store.dispatch("annotations/create",i)}).then(function(){t.fetchCellAnnotations()})},updateGridMetadataStore:function(){var e=this,t=this.getGridMetadataAnnotation(this.gridUuid,this.gridMetadata);return Promise.resolve().then(function(){return e.gridMetadata.uuid?e.$store.dispatch("annotations/patch",[e.gridMetadata.uuid,t]):e.$store.dispatch("annotations/create",t)}).then(function(){e.updateGridDimensions()})},getCellStyle:function(e){return{"grid-column-start":e.x,"grid-column-end":"span ".concat(e.width),"grid-row-start":e.y,"grid-row-end":"span ".concat(e.height)}}}},u=d,h=(i("6y65"),i("KHd+")),m=Object(h["a"])(u,r,s,!1,null,"aeaa8aec",null),g=m.exports,p=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-tabs",{staticClass:"grid-editor-sources-tabs shadow-11",model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[i("q-tab",{attrs:{slot:"title",name:"tab-default-cells",default:"",icon:"add"},slot:"title"}),i("q-tab",{attrs:{slot:"title",name:"tab-magic-box",icon:"wb iridescent"},slot:"title"}),i("q-tab",{attrs:{slot:"title",name:"tab-piecemaker"},slot:"title"},[e._v("Piecemaker")]),i("q-tab",{attrs:{slot:"title",name:"tab-vimeo"},slot:"title"},[e._v("Vimeo")]),i("q-tab",{attrs:{slot:"title",name:"tab-youtube"},slot:"title"},[e._v("YouTube")]),i("q-btn",{staticClass:"fixed",staticStyle:{right:"2px","margin-top":"3px"},attrs:{slot:"title",icon:"close",small:"",flat:"",round:""},on:{click:function(t){e.$store.commit("mosysGridEditorStore/hideSources")}},slot:"title"}),i("q-tab-pane",{attrs:{name:"tab-default-cells"}},[this.selectedCells.length>0?[i("cell-editor",{attrs:{cells:e.selectedCells}})]:[i("source-grid-editor-default")]],2),i("q-tab-pane",{attrs:{name:"tab-magic-box"}},[i("source-grid-editor-magic")],1),i("q-tab-pane",{attrs:{name:"tab-piecemaker"}},[i("source-piecemaker-groups")],1),i("q-tab-pane",{attrs:{name:"tab-vimeo"}},[i("source-vimeo")],1),i("q-tab-pane",{attrs:{name:"tab-youtube"}},[i("source-you-tube")],1)],1)},f=[],y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-list",[e._l(e.cells,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",[i("q-field",{staticStyle:{width:"100%"},attrs:{icon:e.typeToIconName[t.type],helper:e.itemSpecs[t.type].help,error:e.itemSpecs[t.type].error,"error-label":e.itemSpecs[t.type].errorMessage}},[i("q-input",{attrs:{"float-label":e.itemSpecs[t.type].label,type:e.itemSpecs[t.type].inputType,"min-rows":1,"max-height":500,value:t.content},on:{change:function(i){e.handleItemChanged(i,t)}}})],1)],1)]})],2)},v=[],b={props:["cells"],data:function(){return{typeToIconName:{Image:"photo",IFrame:"picture in picture","Internal-Link":"link",Video:"local movies",Text:"subject",Title:"title"},itemSpecs:{Title:{inputType:"text",type:"Title",label:"Title Cell",help:"",error:!1,errorMessage:"",value:""},Text:{inputType:"textarea",type:"Text",label:"Text Cell",help:"",error:!1,errorMessage:"",value:""},Video:{inputType:"url",type:"Video",label:"Video Cell",help:"Insert a URL to: a video file or a Vimeo / YouTube video page",error:!1,errorMessage:"Needs to be a valid URL",value:""},Image:{inputType:"url",type:"Image",label:"Image Cell",help:"Insert a URL to an image file",error:!1,errorMessage:"Needs to be a valid URL",value:""},"Internal-Link":{inputType:"url",type:"Internal-Link",label:"Link Cell",help:"Insert a URL to a page in this system",error:!1,errorMessage:"Needs to be a valid URL",value:""},IFrame:{inputType:"url",type:"IFrame",label:"IFrame Cell",help:"Insert some URL",error:!1,errorMessage:"Needs to be a valid URL",value:""}}}},methods:{handleItemChanged:function(e,t){"url"!==t.inputType?this.updateCellContent(e,t):(t.error=!/^http[s]?:\/\/.+/.test(e),t.error||this.updateCellContent(e,t))},updateCellContent:function(e,t){var i=this;t.sourceUuid&&this.$store.dispatch("annotations/find",{query:{uuid:t.sourceUuid}}).then(function(n){n=n.shift(),t.content=e,n.body.value=JSON.stringify(t),i.$store.dispatch("annotations/patch",[n.uuid,n])})}}},C=b,S=(i("GLJN"),Object(h["a"])(C,y,v,!1,null,"609229c1",null)),x=S.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-list",{staticClass:"default-source-container"},[i("q-list-header",[i("q-item",[i("small",[e._v("Standard Cell Types")])])],1),i("q-item-separator"),e._l(e.items,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",{attrs:{draggable:"true"},on:{dragstart:function(i){e.handleItemDragStart(i,t)}}},[i("q-field",{staticStyle:{width:"100%"},attrs:{icon:e.typeToIconName(t.type),helper:t.help,error:t.error,"error-label":t.errorMessage}},[i("q-input",{attrs:{"float-label":t.label,type:t.inputType,"min-rows":1,"max-height":500,model:t.value,value:t.value},on:{change:function(i){e.handleItemChanged(i,t)}}})],1)],1)]})],2)},T=[],q={image:"photo",iframe:"picture in picture","internal-link":"link",video:"local movies",text:"subject",title:"title"},I={data:function(){return{items:[{inputType:"text",type:"Title",label:"Title Cell",help:"",error:!1,errorMessage:"",value:""},{inputType:"textarea",type:"Text",label:"Text Cell",help:"",error:!1,errorMessage:"",value:""},{inputType:"url",type:"Video",label:"Video Cell",help:"Insert a URL to: a video file or a Vimeo / YouTube video page",error:!1,errorMessage:"Needs to be a valid URL",value:""},{inputType:"url",type:"Image",label:"Image Cell",help:"Insert a URL to an image file",error:!1,errorMessage:"Needs to be a valid URL",value:""},{inputType:"url",type:"Internal-Link",label:"Link Cell",help:"Insert a URL to a page in this system",error:!1,errorMessage:"Needs to be a valid URL",value:""},{inputType:"url",type:"IFrame",label:"IFrame Cell",help:"Insert some URL",error:!1,errorMessage:"Needs to be a valid URL",value:""}]}},methods:{typeToIconName:function(e){var t=q[e.toLowerCase()];return t||(t="broken image"),t},handleItemDragStart:function(e,t){var i={uuid:null,type:t.type,x:1,y:1,width:1,height:1,content:t.value};e.dataTransfer.setData("text/plain",JSON.stringify(i))},handleItemChanged:function(e,t){"url"!==t.inputType?t.value=e:(t.error=!/^http[s]?:\/\/.+/.test(e),t.error||(t.value=e))}}},k=I,_=(i("0GAc"),Object(h["a"])(k,w,T,!1,null,"526afca6",null)),G=_.exports,M=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-list",{staticClass:"default-source-container"},[i("q-list-header",[i("q-input",{style:{"line-height":"1.5em",width:"100%"},attrs:{type:"textarea","min-rows":1,"max-height":200},model:{value:e.term,callback:function(t){e.term=t},expression:"term"}})],1),i("q-item-separator"),0===e.results.length?[i("q-item",[e._v("This is the magic box, just enter:")]),i("q-item",[e._v("● A tag starting with a hash-symbol: "),i("span",[e._v("#my tag")])]),i("q-item",[e._v("● A URL pointing to a video, image or internal or external page")]),i("q-item",[e._v("● Short or long text")])]:e._e(),e.loading?[i("q-item",[i("q-item-side",[i("q-spinner",{staticStyle:{"margin-right":"1em"}})],1),i("q-item-main",[e._v("Loading videos for »"+e._s(e.term)+"«")])],1),i("q-item-separator")]:e.nothingFound?[i("q-item",[e._v("No Videos Found!")])]:e._e(),e.results?[e._l(e.results,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",{attrs:{draggable:"true"},on:{dragstart:function(i){e.handleItemDragStart(i,t)}}},[i("q-item-side",[i("q-icon",{staticStyle:{"font-size":"1.8rem"},attrs:{name:e.typeToIconName(t.body.type)}})],1),i("q-item-main",[i("a",{on:{click:function(i){return i.preventDefault(),function(i){e.handleItemClick(i,t)}(i)}}},[t.body.source?[e._v(e._s(t.body.source.substring(0,100))),t.body.source.length>100?[e._v("...")]:e._e()]:t.body.value?[e._v(e._s(t.body.value.substring(0,100))),t.body.value.length>100?[e._v("...")]:e._e()]:[e._v("Hm, no title?")]],2)])],1)]})]:e._e()],2)},U=[],D=(i("pIFo"),i("CxY0")),V=i.n(D),A={"vimeo.com":"Video","www.vimeo.com":"Video","youtube.com":"Video","www.youtube.com":"Video"},R={image:"photo",iframe:"picture in picture","internal-link":"link",video:"local movies",text:"subject",title:"title"},E={"image/jpeg":"Image","image/png":"Image","image/gif":"Image","image/svg+xml":"Image","image/tiff":"Image","image/webp":"Image","application/pdf":"PDF-Document","video/webm":"Video","video/3gpp":"Video","video/3gpp2":"Video","video/x-msvideo":"Video","video/mpeg":"Video","video/mp4":"Video","video/ogg":"Video","audio/x-wav":"Audio","audio/webm":"Audio","audio/3gpp":"Audio","audio/3gpp2":"Audio","audio/aac":"Audio","audio/midi":"Audio","audio/ogg":"Audio","text/csv":"Unknown","text/calendar":"Unknown","application/json":"Unknown","application/rtf":"Unknown","application/xml":"Unknown","text/plain":"IFrame","text/html":"IFrame","application/xhtml+xml":"IFrame"},L={data:function(){return{term:"",results:[],nothingFound:!1,loading:!1}},watch:{term:function(){this.term=this.term.trim(),this.handleSearchTerm()}},methods:{typeToIconName:function(e){var t=R[e.toLowerCase()];return t||(t="broken image"),t},handleItemClick:function(){},handleItemDragStart:function(e,t){var i={uuid:null,type:t.body.type,x:1,y:1,width:1,height:1,content:t.body.source,sourceUuid:t.body.sourceUuid};e.dataTransfer.setData("text/plain",JSON.stringify(i))},handleSearchTerm:function(){var e=this,t=this;if(this.term.length>0){var i={body:{source:this.term,purpose:"linking",type:"Undefined"}},n=[];if(/^[\s]*http[s]?:\/\/.+/.test(this.term)){var a=V.a.parse(this.term),r=V.a.parse(window.location.href),s="Unknown";if(a.host===r.host){s="Internal-Link";var l=a.path;i.body.source=l}else s=this.getTypeFromSourceURL(a);s?(i.body.type=s,n.push(i)):(s="IFrame",t.$axios.get("".concat(t.$globalConfig.app.hosts.api,"/proxy?url=").concat(encodeURIComponent(this.term))).then(function(a){301===a.status?a.headers["location"]&&(t.term=a.headers["location"]):(i.body.type=t.mimeTypeToType(a.headers["content-type"]),n.push(i),e.results=n)}).catch(function(){n.push(i)}))}else if(/^[\s]*#.+/.test(this.term)){var c=this.term.replace(/^[\s]*#/,"").toLowerCase();t.$store.dispatch("annotations/find",{query:{"body.purpose":"tagging"}}).then(function(e){console.log(e);var i={};e.filter(function(e){return e.body.value.toLowerCase().indexOf(c)>=0}).map(function(e){i[e.target.id]||(i[e.target.id]=e,e.body.type=e.target.type||e.body.type,e.body.source=e.target.id,e.body.sourceUuid=e.target.id,n.push(e))}),t.results=n})}else if(/[\n\r]/.test(this.term)||this.term.length>200)i.body.type="text",n.push(i);else{i.body.type="title",n.push(i);var d=o["ObjectUtil"].merge({},i.body);d.type="text",n.push({body:d})}this.results=n}else this.results=[]},getTypeFromSourceURL:function(e){var t=A[e.hostname];return t||(console.log("Unknown URL resource",e.toString()),null)},mimeTypeToType:function(e){var t=E[e];return t||(t="IFrame"),t}}},$=L,N=(i("f/hW"),Object(h["a"])($,M,U,!1,null,"148e4316",null)),O=N.exports,F=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-list",{staticClass:"piecemaker-source-container"},[i("q-list-header",[e.currentGroup?[i("q-btn",{staticStyle:{"margin-right":"0.5em"},attrs:{flat:"",round:"",small:"",icon:"keyboard backspace"},on:{click:e.handleClickUnsetCurrentGroup}}),i("span",[e._v("Videos in Group "),i("strong",[e._v(e._s(e.currentGroup.title))])])]:[i("router-link",{attrs:{to:{name:"piecemaker.groups.list"}}},[e._v("Piecemaker Groups")])]],2),i("q-item-separator"),e.currentGroup?[0===e.currentVideos.length?[e.loadingVideos?[i("q-item",[i("q-item-side",[i("q-spinner",{staticStyle:{"margin-right":"1em"}})],1),i("q-item-main",[e._v("Loading Videos")])],1)]:[i("q-item",[e._v("No Videos Found!")])]]:[e._l(e.currentVideos,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",{staticClass:"video-item"},[i("q-item-side",[i("q-icon",{staticStyle:{"font-size":"1.8rem"},attrs:{draggable:"true",name:"local movies"},on:{dragstart:function(i){e.handleVideoItemDragStart(i,t,"Video")}}}),i("q-icon",{staticStyle:{"font-size":"1.8rem"},attrs:{draggable:"true",name:"comment"},on:{dragstart:function(i){e.handleVideoItemDragStart(i,t,"Annotation-List")}}})],1),i("q-item-main",[i("a",{on:{click:function(i){return i.preventDefault(),function(i){e.handleVideoItemClick(i,t)}(i)}}},[e._v(e._s(t.title))])])],1)]})]]:[e._l(e.groups,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",[i("q-item-side",[i("q-icon",{staticStyle:{"font-size":"1.8rem"},attrs:{name:"list"}})],1),i("q-item-main",[i("a",{on:{click:function(i){return i.preventDefault(),function(i){e.handleGroupItemClick(i,t)}(i)}}},[e._v(e._s(t.title))])])],1)]})]],2)},P=[],j=(i("SRfc"),i("wbdi")),z=i("9oTK"),J=i.n(z),B=i("33yf"),Y=i.n(B),K=i("ktc5"),H=i.n(K),Z={data:function(){return{groups:[],currentGroup:null,currentVideos:[],loadingVideos:!1}},mounted:function(){var e=this;this.$store.dispatch("maps/find",{query:{type:j["a"].MAP_TYPE_TIMELINE}}).then(function(t){e.groups=t})},methods:{handleGroupItemClick:function(e,t){var i=this;this.currentGroup=t,this.currentVideos=[],this.loadingVideos=!0;var n=this;this.$store.dispatch("annotations/find",{query:{type:"Annotation","body.purpose":"linking","target.id":this.currentGroup.uuid}}).then(function(e){return J.a.map(e,function(e){var t=o["ObjectUtil"].merge({},e);return t.title=e.body.source,J.a.resolve().then(function(){if(0===e.body.source.indexOf("http")&&".mp4"!==Y.a.extname(V.a.parse(e.body.source).path))return n.$axios.get("".concat(n.$globalConfig.app.hosts.api,"/proxy?url=").concat(encodeURIComponent(e.body.source))).then(function(e){var i=e.text.match(/<title[^>]*>([^<]+)<\/title>/)[1];t.title=H.a.decode(i)}).catch(function(t){console.warn("Error getting title for ".concat(e.body.source,": ").concat(t.message))})}).then(function(){return t})})}).then(function(e){n.currentVideos=e,i.loadingVideos=!1})},handleClickUnsetCurrentGroup:function(){this.currentGroup=null,this.currentVideos=[]},handleVideoItemClick:function(){},handleVideoItemDragStart:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Video",n={uuid:null,type:i,x:1,y:1,width:1,height:1,content:"Video"===i?t.body.source:t.uuid,sourceUuid:t.uuid};e.dataTransfer.setData("text/plain",JSON.stringify(n))}}},W=Z,Q=(i("nKL5"),Object(h["a"])(W,F,P,!1,null,"28cb642a",null)),X=Q.exports,ee=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-list",{staticClass:"vimeo-source-container"},[i("q-list-header",[i("q-input",{model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}})],1),i("q-item-separator"),e.loadingVideos?[i("q-item",[i("q-item-side",[i("q-spinner",{staticStyle:{"margin-right":"1em"}})],1),i("q-item-main",[e._v("Loading videos for »"+e._s(e.lastSearchTerm)+"«")])],1),i("q-item-separator")]:0===e.searchResults.length?[i("q-item",[e._v("No Videos Found!")])]:e._e(),e.searchResults.length>0?[e._l(e.searchResults,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",{attrs:{draggable:"true"},on:{dragstart:function(i){e.handleVideoItemDragStart(i,t)}}},[i("q-item-side",[t.pictures[4]?[i("img",{staticStyle:{width:"100%","max-width":"50px"},attrs:{src:t.pictures[4].link}})]:[i("q-icon",{staticStyle:{"font-size":"1.8rem"},attrs:{name:"local movies"}})]],2),i("q-item-main",[i("a",{on:{click:function(i){return i.preventDefault(),function(i){e.handleVideoItemClick(i,t)}(i)}}},[e._v(e._s(t.name.substring(0,100)))])])],1)]})]:e._e()],2)},te=[],ie="8dbc7f72ddb834a4665dbb6989014699",ne="https://api.vimeo.com",ae="/videos",re={data:function(){return{searchTerm:"",searchResults:[],loadingVideos:!1,lastSearchTerm:""}},watch:{searchTerm:function(){this.loadingVideos||this.loadVideos()}},methods:{loadVideos:function(){var e=this;this.searchTerm.length>=3?(this.loadingVideos=!0,this.lastSearchTerm=this.searchTerm,this.$axios.get(ne+ae,{query:this.searchTerm,access_token:ie}).then(function(t){e.searchResults=t.body.data,e.checkNewSearchTerm()}).catch(function(){console.log("Failed to load Vimeo results for",e.searchTerm),e.checkNewSearchTerm()})):0===this.searchTerm.length&&(this.searchResults=[],this.lastSearchTerm="")},checkNewSearchTerm:function(){this.searchTerm!==this.lastSearchTerm?this.loadVideos():this.loadingVideos=!1},handleVideoItemClick:function(){},handleVideoItemDragStart:function(e,t){var i={uuid:null,type:"Video",x:1,y:1,width:1,height:1,content:t.link};e.dataTransfer.setData("text/plain",JSON.stringify(i))}}},se=re,oe=(i("FSkN"),Object(h["a"])(se,ee,te,!1,null,"1a4d66e3",null)),le=oe.exports,ce=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-list",{staticClass:"youtube-source-container"},[i("q-list-header",[i("q-input",{model:{value:e.searchTerm,callback:function(t){e.searchTerm=t},expression:"searchTerm"}})],1),i("q-item-separator"),e.loadingVideos?[i("q-item",[i("q-item-side",[i("q-spinner",{staticStyle:{"margin-right":"1em"}})],1),i("q-item-main",[e._v("Loading videos for »"+e._s(e.lastSearchTerm)+"«")])],1),i("q-item-separator")]:0===e.searchResults.length?[i("q-item",[e._v("No Videos Found!")])]:e._e(),e.searchResults.length>0?[e._l(e.searchResults,function(t,n){return[n>0?[i("q-item-separator")]:e._e(),i("q-item",{attrs:{draggable:"true"},on:{dragstart:function(i){e.handleVideoItemDragStart(i,t)}}},[i("q-item-side",[t.snippet.thumbnails.default?[i("img",{staticStyle:{width:"100%","max-width":"50px"},attrs:{src:t.snippet.thumbnails.default.url}})]:[i("q-icon",{staticStyle:{"font-size":"1.8rem"},attrs:{name:"local movies"}})]],2),i("q-item-main",[i("a",{on:{click:function(i){return i.preventDefault(),function(i){e.handleVideoItemClick(i,t)}(i)}}},[e._v(e._s(t.snippet.title.substring(0,100)))])])],1)]})]:e._e()],2)},de=[],ue="AIzaSyCMfeZXhTec0elm19N_2TTBHNZR2hpl-5Q",he="https://www.googleapis.com",me="/youtube/v3/search",ge={data:function(){return{searchTerm:"",searchResults:[],loadingVideos:!1,lastSearchTerm:""}},watch:{searchTerm:function(){this.loadingVideos||this.loadVideos()}},methods:{loadVideos:function(){var e=this;this.searchTerm.length>=3?(this.loadingVideos=!0,this.lastSearchTerm=this.searchTerm,this.$axios.get(he+me,{q:this.searchTerm,part:"snippet",maxResults:30,key:ue}).then(function(t){e.searchResults=t.body.items,e.checkNewSearchTerm()}).catch(function(){console.log("Failed to load YouTube results for",e.searchTerm),e.checkNewSearchTerm()})):0===this.searchTerm.length&&(this.searchResults=[],this.lastSearchTerm="")},checkNewSearchTerm:function(){this.searchTerm!==this.lastSearchTerm?this.loadVideos():this.loadingVideos=!1},handleVideoItemClick:function(){},handleVideoItemDragStart:function(e,t){var i={uuid:null,type:"Video",x:1,y:1,width:1,height:1,content:"https://www.youtube.com/watch?v="+t.id.videoId};e.dataTransfer.setData("text/plain",JSON.stringify(i))}}},pe=ge,fe=(i("8yf9"),Object(h["a"])(pe,ce,de,!1,null,"f32a816c",null)),ye=fe.exports,ve={components:{CellEditor:x,SourceGridEditorDefault:G,SourceGridEditorMagic:O,SourcePiecemakerGroups:X,SourceVimeo:le,SourceYouTube:ye},data:function(){return{selectedTab:""}},computed:{currentStoreTab:function(){return this.$store.state.mosysGridEditorStore.sourcesTabName},selectedCells:function(){return this.$store.state.mosysGridEditorStore.selectedCells}},watch:{currentStoreTab:function(){this.selectedTab!==this.currentStoreTab&&(this.selectedTab=this.currentStoreTab)},selectedTab:function(){this.selectedTab!==this.currentStoreTab&&this.$store.commit("mosysGridEditorStore/setSourcesTab",this.selectedTab)}},beforeDestroy:function(){this.$store.commit("mosysGridEditorStore/hideSources")}},be=ve,Ce=(i("Egr1"),Object(h["a"])(be,p,f,!1,null,null,null)),Se=Ce.exports,xe={components:{GridEditor:g,GridEditorSources:Se}},we=xe,Te=(i("mkVz"),Object(h["a"])(we,n,a,!1,null,"04c76e0d",null));t["default"]=Te.exports},aEYj:function(e,t,i){},cRqT:function(e,t,i){},"f/hW":function(e,t,i){"use strict";var n=i("qhmS"),a=i.n(n);a.a},gdU5:function(e,t,i){},hGge:function(e,t,i){},mkVz:function(e,t,i){"use strict";var n=i("D/9Z"),a=i.n(n);a.a},nKL5:function(e,t,i){"use strict";var n=i("MlLm"),a=i.n(n);a.a},qhmS:function(e,t,i){},uQw1:function(e,t,i){}}]);