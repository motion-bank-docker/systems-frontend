(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"6VKw":function(t,i,e){"use strict";var n=e("YJ+K"),a=e.n(n);a.a},I6O3:function(t,i,e){"use strict";e.r(i);var n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"grid-display-container"},[e("div",{staticClass:"backbutton"},[e("q-btn",{attrs:{slot:"backButton",icon:"keyboard_backspace",round:"",small:"",color:"black"},on:{click:function(i){t.$router.push("/mosys/grids")}},slot:"backButton"})],1),e("grid-display",{staticClass:"grid-display",attrs:{gridUuid:t.$route.params.id}})],1)},a=[],s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"cell-grid-container"},[e("div",{staticClass:"cell-grid",style:t.gridStyle},[t._l(t.cells,function(i,n){return[e("div",{staticClass:"cell-item",style:t.getCellStyle(i),attrs:{title:i.title}},[e("cell",{attrs:{cell:i,display:"",messenger:t.messenger}})],1)]}),t.$store.state.auth.payload?e("q-fixed-position",{attrs:{corner:"top-right",offset:[18,18]}},[e("q-btn",{attrs:{round:"",color:"primary",small:""},on:{click:function(i){t.$router.push("/mosys/grids/"+t.$route.params.id+"/annotate")}}},[e("q-icon",{attrs:{name:"edit"}})],1)],1):t._e()],2)])},r=[],o=(e("VRzm"),e("Kw5r")),d=e("Nxwe"),l=o["a"].component("grid-editor-messenger",{}),u={components:{Cell:d["a"]},props:["gridUuid"],data:function(){return{annotations:[],cells:[],gridMetadata:{},gridDimensions:{gridWidth:0,gridHeight:0,cellWidth:0,cellHeight:0},gridStyle:{},messenger:new l}},mounted:function(){var t=this,i=this;window.addEventListener("resize",this.updateGridDimensions),this.messenger.$on("video-loaded",function(){}),this.messenger.$on("video-time-changed",function(){}),this.fetchMetadataAnnotations().then(function(){t.updateGridDimensions(),i.fetchCellAnnotations()})},watch:{gridUuid:function(){var t=this,i=this;this.fetchMetadataAnnotations().then(function(){t.updateGridDimensions(),i.fetchCellAnnotations()})}},methods:{fetchCellAnnotations:function(){var t=this,i={query:{"body.type":"2DCell","target.id":this.gridUuid}};this.$store.dispatch("annotations/find",i).then(function(i){t.annotations=i,t.cells=i.map(function(t){var i=JSON.parse(t.body.value);return i?(i.uuid=t.uuid,i):null}).filter(function(t){return t})})},fetchMetadataAnnotations:function(){var t=this,i=this,e={query:{"body.type":"2DGridMetadata","target.id":this.gridUuid}};return new Promise(function(n,a){t.$store.dispatch("annotations/find",e).then(function(t){var e=t.shift();if(e){var a=JSON.parse(e.body.value);a.uuid=e.uuid,a&&(i.gridMetadata=a,n())}else i.gridMetadata={columns:10,rows:6,ratio:16/9},i.updateGridMetadataStore()}).catch(a)})},updateCellStore:function(t){var i=this,e=this.getGridCellAnnotation(t);Promise.resolve().then(function(){return t.uuid?i.$store.dispatch("annotations/patch",[t.uuid,e]):i.$store.dispatch("annotations/create",e)}).then(function(){i.fetchCellAnnotations()})},updateGridMetadataStore:function(){var t=this,i=this.getGridMetadataAnnotation(this.gridUuid,this.gridMetadata);return Promise.resolve().then(function(){return t.gridMetadata.uuid?t.$store.dispatch("annotations/patch",[t.gridMetadata.uuid,i]):t.$store.dispatch("annotations/create",i)}).then(function(){t.updateGridDimensions()})},updateGridDimensions:function(){var t=this.$el.offsetWidth,i=this.$el.offsetHeight,e=this.gridMetadata.ratio,n=i,a=n/this.gridMetadata.rows,s=t/Math.round(t/(a*e)),r=s*this.gridMetadata.columns,o=t/s,d=t/this.gridMetadata.columns,l=d/e;this.gridDimensions={full:{width:r,height:n,cell:{width:s,height:a},cells_per_width:o},mini:{width:t,height:l*this.gridMetadata.rows,cell:{width:d,height:l}}},this.gridStyle=t>800?{width:this.gridDimensions.full.width+"px",height:"100%","grid-auto-columns":this.gridDimensions.full.cell.width+"px","grid-auto-rows":this.gridDimensions.full.cell.height+"px"}:{width:"100%",height:this.gridDimensions.mini.height+"px","grid-auto-columns":this.gridDimensions.mini.cell.width+"px","grid-auto-rows":this.gridDimensions.mini.cell.height+"px"}},getGridMetadataAnnotation:function(t,i){return{body:{type:"2DGridMetadata",purpose:"linking",value:JSON.stringify(i)},author:this.$store.state.auth.payload.userId,target:{id:t,type:"Map"}}},getCellStyle:function(t){return{"grid-column-start":t.x,"grid-column-end":"span ".concat(t.width),"grid-row-start":t.y,"grid-row-end":"span ".concat(t.height)}}}},c=u,h=(e("6VKw"),e("KHd+")),g=Object(h["a"])(c,s,r,!1,null,"2efc7456",null),p=g.exports,f={components:{GridDisplay:p}},m=f,w=(e("KHKp"),Object(h["a"])(m,n,a,!1,null,"6daad63f",null));i["default"]=w.exports},KHKp:function(t,i,e){"use strict";var n=e("x0Pc"),a=e.n(n);a.a},"YJ+K":function(t,i,e){},x0Pc:function(t,i,e){}}]);